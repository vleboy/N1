namespace: 'bill'

attrs: sn,businessKey,parent,userId,userName,gameType,gameId,type,originalAmount,amount,balance,sourceIP,country,province,city,createdAt

findAll:
    - select * from bill

insert:
    - insert into bill({{bill.attrs }})
    - values(:sn,:businessKey,:parent,:userId,:userName,:gameType,:gameId,:type,:originalAmount,:amount,:balance,:sourceIP,:country,:province,:city,:createdAt)

batchInsert:
    - replace into bill({{ bill.attrs }}) values
    - for:
        array: data
        sql: (:sn,:businessKey,:parent,:userId,:userName,:gameType,:gameId,:type,:originalAmount,:amount,:balance,:sourceIP,:country,:province,:city,:createdAt)
        seperator: ','

chinaPlayerCount: # 玩家总人数
    - select count(a.userId) as total,a.province from 
    - (select distinct(userId),province from bill where createdAt between :startTime and :endTime
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - ) as a
    - group by a.province

chinaBetCount:  # 下注总次数
    - select count(*) as total,province from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by province

chinaBetAmount: # 下注总金额
    - select sum(amount) as total,province from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by province

chinaRetAmount: # 返奖总金额
    - select sum(amount) as total,province from bill where createdAt between :startTime and :endTime and type=4
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by province   

chinaRefundAmount: # 退款总金额
    - select sum(amount) as total,province from bill where createdAt between :startTime and :endTime and type=5
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by province

chinaWinloseAmount: # 输赢总金额
    - select sum(amount) as total,province from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by province

worldPlayerCount: # 玩家总人数
    - select count(a.userId) as total,a.province from 
    - (select distinct(userId),country as province from bill where createdAt between :startTime and :endTime
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - ) as a
    - group by a.province

worldBetCount:  # 下注总次数
    - select count(*) as total,country as province from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by country

worldBetAmount: # 下注总金额
    - select sum(amount) as total,country as province from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by country

worldRetAmount: # 返奖总金额
    - select sum(amount) as total,country as province from bill where createdAt between :startTime and :endTime and type=4
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by country   

worldRefundAmount: # 退款总金额
    - select sum(amount) as total,country as province from bill where createdAt between :startTime and :endTime and type=5
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by country

worldWinloseAmount: # 输赢总金额
    - select sum(amount) as total,country as province from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by country

playerCountDay: # 实时统计当天人数
    - select count(a.userId) as total from
    - (select distinct(userId) from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - group by userId ) as a

betCountDay: # 实时统计当天下注总次数
    - select count(*) as total from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType

betAmountDay: # 实时统计当天下注总金额
    - select sum(amount) as total from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType

retAmountDay: # 实时统计当天返奖总额
    - select sum(amount) as total from bill where createdAt between :startTime and :endTime and type=4
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType

refundAmountDay: # 实时统计当天退款总金额
    - select sum(amount) as total from bill where createdAt between :startTime and :endTime and type=5
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType

winloseAmountDay: # 实时统计当天输赢金额
    - select sum(amount) as total from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType

playerCountGraph: # 统计人数
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,count(sn) count from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

betCountGraph: # 统计下注总次数
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,count(sn) count from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

betAmountGraph: # 统计下注总金额
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,sum(amount) count from bill where createdAt between :startTime and :endTime and type=3
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

retAmountGraph: # 统计返奖总额
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,sum(amount) count from bill where createdAt between :startTime and :endTime and type=4
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

refundAmountGraph: # 统计退款总金额
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,sum(amount) count from bill where createdAt between :startTime and :endTime and type=5
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

winloseAmountGraph: # 实时统计当天输赢金额
    - SELECT FROM_UNIXTIME(createdAt/1000,'%k')days,sum(amount) count from bill where createdAt between :startTime and :endTime 
    - if:
        test: :gameType!=null
        sql: and gameType=:gameType
    - GROUP BY days

playerCountPie: # 统计人数
    - SELECT ROUND(a.num/b.total*100,2) as percent,a.gameType from (select count(c.userId) as num,c.gameType from 
    - (SELECT gameType,userId from bill where createdAt between :startTime and :endTime GROUP BY gameType,userId) as c GROUP BY c.gameType) as a,
    - (SELECT count(DISTINCT userId,gameType) as total from bill) as b

betCountPie: # 统计下注总次数
    - SELECT ROUND(a.num/b.total *100,2) as percent,a.gameType from 
    - (SELECT count(*) as num,gameType from bill where createdAt between :startTime and :endTime and type=3 GROUP BY gameType) as a,
    - (SELECT count(*) as total from bill)as b;

betAmountPie: # 统计下注总金额
    - SELECT ROUND(a.num/b.total *100,2) as percent,a.gameType from 
    - (SELECT sum(amount) as num,gameType from bill where createdAt between :startTime and :endTime and type=3 GROUP BY gameType) as a,
    - (SELECT sum(amount) as total from bill where type=3 )as b;

retAmountPie: # 统计返奖总额
    - SELECT ROUND(a.num/b.total *100,2) as percent,a.gameType from 
    - (SELECT sum(amount) as num,gameType from bill where createdAt between :startTime and :endTime and type=4 GROUP BY gameType) as a,
    - (SELECT sum(amount) as total from bill where type=4 )as b;

refundAmountPie: # 统计退款总金额
    - SELECT ROUND(a.num/b.total *100,2) as percent,a.gameType from 
    - (SELECT sum(amount) as num,gameType from bill where createdAt between :startTime and :endTime and type=5 GROUP BY gameType) as a,
    - (SELECT sum(amount) as total from bill where type=5 )as b;

winloseAmountPie: # 实时统计当天输赢金额
    - SELECT ROUND(a.num/b.total *100,2) as percent,a.gameType from 
    - (SELECT sum(amount) as num,gameType from bill where createdAt between :startTime and :endTime GROUP BY gameType) as a,
    - (SELECT sum(amount) as total from bill )as b;